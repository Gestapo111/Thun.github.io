<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Encuesta Socioemocional</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
    <script type="text/javascript" src="https://cdn.emailjs.com/dist/email.min.js"></script>
    <script type="text/javascript">
      (function(){
        emailjs.init("YOUR_USER_ID"); // Reemplaza "YOUR_USER_ID" con tu ID de usuario EmailJS
      })();
    </script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }
        .container {
            width: 80%;
            margin: 20px auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            margin-bottom: 20px;
        }
        .question {
            margin-bottom: 15px;
        }
        .options {
            display: flex;
            justify-content: space-around;
            margin-top: 5px;
            margin-bottom: 15px;
        }
        .options input[type="radio"] {
            margin-right: 5px;
        }
        button {
            display: block;
            width: 100%;
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
        }
        button:hover {
            background-color: #0056b3;
        }
        #recommendations {
            margin-top: 20px;
        }
        #resultsChart {
            margin-top: 20px;
        }
        .error {
            color: red;
            margin-top: 10px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Encuesta Socioemocional</h1>
        <form id="surveyForm">
            <div>
                <label for="nie">NIE (Número de Identificación Estudiantil):</label>
                <input type="text" id="nie" name="nie" required>
                <div id="error" class="error">Por favor, ingrese un NIE válido.</div>
            </div>
            <!-- Preguntas del 1 al 20 -->
            <!-- ... -->
            <div class="question">
                <label for="q20">20. ¿Te sientes capaz de lograr un bienestar emocional duradero?</label>
                <div class="options">
                    <input type="radio" id="q20_1" name="q20" value="1"> Necesita mejorar
                    <input type="radio" id="q20_2" name="q20" value="2"> Bueno
                    <input type="radio" id="q20_3" name="q20" value="3"> Muy Bueno
                    <input type="radio" id="q20_4" name="q20" value="4"> Excelente
                </div>
            </div>
            <button type="button" onclick="validateAndSubmit()">Ver Resultados</button>
        </form>
        <canvas id="resultsChart"></canvas>
        <div id="recommendations"></div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        function validateAndSubmit() {
            const nie = document.getElementById('nie').value.trim();
            const email = `${nie}@cleses.edu.sv`;

            // Validar que el NIE no esté vacío y tenga el formato esperado
            if (nie === "" || !/^\d+$/.test(nie)) {
                document.getElementById('error').style.display = 'block';
                return;
            } else {
                document.getElementById('error').style.display = 'none';
            }

            // Continúa con el procesamiento si la validación es exitosa
            generateChart(email);
        }

        function sendEmail(recommendations, email) {
            const templateParams = {
                email: email,
                recommendations: recommendations.join('\n')
            };

            emailjs.send('YOUR_SERVICE_ID', 'YOUR_TEMPLATE_ID', templateParams)
                .then(function(response) {
                    console.log('Correo enviado exitosamente!', response.status, response.text);
                }, function(error) {
                    console.log('Fallo en el envío del correo.', error);
                });
        }

        function generateChart(email) {
            const formData = new FormData(document.getElementById('surveyForm'));
            const results = [];
            const recommendations = [];

            for (let i = 1; i <= 20; i++) {
                const value = parseInt(formData.get(`q${i}`));
                results.push(value);

                if (value === 1) {
                    recommendations.push(`En la pregunta ${i}: ${generateRecommendation(i, 'mejorar')}`);
                } else if (value === 2) {
                    recommendations.push(`En la pregunta ${i}: ${generateRecommendation(i, 'bueno')}`);
                }
            }

            // Enviar correo con las recomendaciones
            if (recommendations.length > 0) {
                sendEmail(recommendations, email);
            }

            // Generar gráfico de barras
            const ctx = document.getElementById('resultsChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: results.map((_, index) => `Pregunta ${index + 1}`),
                    datasets: [{
                        label: 'Resultado',
                        data: results,
                        backgroundColor: results.map(value => {
                            switch(value) {
                                case 1: return 'rgba(255, 99, 132, 0.2)'; // Rojo para "Necesita mejorar"
                                case 2: return 'rgba(255, 159, 64, 0.2)'; // Naranja para "Bueno"
                                case 3: return 'rgba(75, 192, 192, 0.2)'; // Verde para "Muy Bueno"
                                case 4: return 'rgba(54, 162, 235, 0.2)'; // Azul para "Excelente"
                            }
                        }),
                        borderColor: results.map(value => {
                            switch(value) {
                                case 1: return 'rgba(255, 99, 132, 1)';
                                case 2: return 'rgba(255, 159, 64, 1)';
                                case 3: return 'rgba(75, 192, 192, 1)';
                                case 4: return 'rgba(54, 162, 235, 1)';
                            }
                        }),
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 4,
                            ticks: {
                                stepSize: 1,
                                callback: function(value) { 
                                    const labels = ['Necesita mejorar', 'Bueno', 'Muy Bueno', 'Excelente'];
                                    return labels[value - 1]; 
                                }
                            }
                        }
                    }
                }
            });

            // Mostrar recomendaciones en la página
            const recommendationsContainer = document.getElementById('recommendations');
            recommendationsContainer.innerHTML = ''; // Limpiar recomendaciones anteriores
            if (recommendations.length > 0) {
                recommendationsContainer.innerHTML = '<h3>Recomendaciones:</h3><ul>' + recommendations.map(rec => `<li>${rec}</li>`).join('') + '</ul>';
            } else {
                recommendationsContainer.innerHTML = '<h3>No hay recomendaciones específicas. ¡Sigue así!</h3>';
            }
        }

        function generateRecommendation(questionNumber, category) {
            const recommendations = {
                1: {
                    mejorar: 'Es importante identificar las áreas de tu vida que te causan insatisfacción. Considera trabajar con un terapeuta para explorar estas áreas y desarrollar estrategias que te ayuden a mejorar tu bienestar general.',
                    bueno: 'Aunque te sientes generalmente satisfecho, siempre hay espacio para mejorar. Reflexiona sobre lo que podría elevar tu satisfacción a un nivel "Muy Bueno" o "Excelente" y establece metas claras para alcanzarlo.'
                },
                2: {
                    mejorar: 'Sentirse fuera de control puede ser una fuente significativa de estrés. Te recomiendo trabajar en la gestión del tiempo y la planificación diaria. La terapia cognitiva puede ayudarte a cambiar tu perspectiva y ganar más control.',
                    bueno: 'Mantén y fortalece las áreas en las que te sientes en control. Considera técnicas como la priorización y la planificación estratégica para aumentar tu sensación de control.'
                },
                3: {
                    mejorar: 'El estrés frecuente puede ser debilitante. Te sugiero aprender y practicar técnicas de manejo del estrés, como la meditación, el ejercicio regular o la terapia cognitiva.',
                    bueno: 'Aunque tu nivel de estrés es manejable, puedes beneficiarte al aprender nuevas técnicas de relajación o al mejorar tu capacidad para anticipar y evitar situaciones estresantes.'
                },
                4: {
                    mejorar: 'El apoyo social es crucial para el bienestar emocional. Trabaja en fortalecer tus relaciones o busca nuevas conexiones a través de actividades sociales o grupos de apoyo.',
                    bueno: 'Asegúrate de mantener y nutrir las relaciones que tienes. Puedes mejorar aún más tu red de apoyo al ser proactivo en comunicarte y compartir con amigos y familiares.'
                },
                5: {
                    mejorar: 'Experimentar pocas emociones positivas puede ser un signo de depresión o anhedonia. Considera la terapia para explorar la causa subyacente y desarrollar estrategias para aumentar las experiencias positivas en tu vida.',
                    bueno: 'Aumentar la frecuencia de emociones positivas puede ser posible al practicar la gratitud diaria, participar en actividades que disfrutas, y rodearte de personas que te hagan sentir bien.'
                },
                6: {
                    mejorar: 'La falta de paz interior puede ser un indicador de conflicto interno o estrés no resuelto. Trabaja en desarrollar una mayor autoaceptación y explora técnicas de mindfulness o meditación.',
                    bueno: 'Si bien te sientes en paz frecuentemente, podrías trabajar en mantener esta paz durante los momentos más difíciles. La práctica regular de mindfulness puede ayudarte a mantener la calma en situaciones estresantes.'
                },
                7: {
                    mejorar: 'Manejar mal los conflictos emocionales puede llevar a relaciones tensas y estrés. Trabaja en desarrollar habilidades de comunicación y resolución de conflictos con la ayuda de un terapeuta.',
                    bueno: 'Mejorar en la gestión de conflictos emocionales puede ser clave para relaciones más saludables. Considera aprender nuevas técnicas de comunicación asertiva y manejo emocional.'
                },
                8: {
                    mejorar: 'La falta de motivación puede estar relacionada con depresión o falta de claridad en tus objetivos. Trabaja en definir metas claras y alcanzables, y considera buscar apoyo para superar cualquier barrera emocional.',
                    bueno: 'Aunque tienes un nivel de motivación razonable, podrías beneficiarte al crear un plan de acción más detallado para alcanzar tus metas y establecer hitos para mantenerte enfocado.'
                },
                9: {
                    mejorar: 'Sentirse incomprendido puede ser frustrante y llevar al aislamiento. Trabaja en mejorar tus habilidades de comunicación y busca entornos donde te sientas más escuchado y valorado.',
                    bueno: 'Aumentar la frecuencia con la que te sientes comprendido puede requerir mejorar la forma en que expresas tus sentimientos y pensamientos a los demás.'
                },
                10: {
                    mejorar: 'La inestabilidad emocional puede ser indicativa de trastornos de ánimo o problemas de manejo del estrés. Considera la terapia para desarrollar herramientas que te ayuden a estabilizar tus emociones.',
                    bueno: 'Continuar fortaleciendo tu estabilidad emocional es importante. Trabaja en identificar y reducir factores estresantes que puedan desestabilizarte.'
                },
                11: {
                    mejorar: 'La ansiedad frecuente puede requerir intervención psicológica. Aprende técnicas de manejo de la ansiedad, como la respiración profunda, la meditación y la reestructuración cognitiva.',
                    bueno: 'Aunque tu ansiedad no es excesiva, puedes trabajar en reducirla aún más mediante el ejercicio regular, técnicas de relajación, y cambios en el estilo de vida.'
                },
                12: {
                    mejorar: 'La incapacidad para expresar emociones puede llevar a la acumulación de tensión y estrés. Trabaja en desarrollar habilidades de comunicación emocional a través de la terapia o talleres de desarrollo personal.',
                    bueno: 'Aunque te sientes capaz, mejorar tus habilidades de expresión emocional puede ayudarte a comunicarte más claramente y a mejorar tus relaciones.'
                },
                13: {
                    mejorar: 'La insatisfacción en las relaciones personales puede ser un indicador de problemas de comunicación o expectativas no cumplidas. Trabaja en fortalecer tus relaciones actuales y considera terapia de pareja o familiar si es necesario.',
                    bueno: 'Fortalecer y mejorar tus relaciones personales puede llevar a una mayor satisfacción. Trabaja en la comunicación abierta y en pasar tiempo de calidad con tus seres queridos.'
                },
                14: {
                    mejorar: 'Si te cuesta manejar el estrés, es importante que aprendas técnicas de manejo del estrés y consideres la terapia para desarrollar un enfoque más resiliente.',
                    bueno: 'Puedes mejorar tu capacidad de manejo del estrés al practicar técnicas de relajación regularmente y al mejorar tu capacidad de anticipar y planificar situaciones estresantes.'
                },
                15: {
                    mejorar: 'La falta de felicidad puede ser un signo de depresión o insatisfacción en varias áreas de la vida. Trabaja en identificar y abordar los factores que contribuyen a este sentimiento y considera la terapia para apoyo adicional.',
                    bueno: 'Aumentar tu felicidad puede requerir una mayor dedicación a actividades que disfrutas y una práctica diaria de la gratitud.'
                },
                16: {
                    mejorar: 'La indecisión o arrepentimiento constante puede ser un signo de baja autoconfianza. Trabaja en mejorar tu proceso de toma de decisiones y considera la terapia para explorar las causas subyacentes.',
                    bueno: 'Fortalecer la paz con tus decisiones puede requerir una mayor claridad en tus valores y prioridades, así como la práctica de la autoaceptación.'
                },
                17: {
                    mejorar: 'La dificultad para adaptarse al cambio puede generar ansiedad y estrés. Trabaja en desarrollar una mentalidad más flexible y considera la terapia para manejar la resistencia al cambio.',
                    bueno: 'Mejorar tu adaptación al cambio puede ser clave para tu crecimiento personal. Practica la aceptación y busca oportunidades de aprendizaje en cada cambio.'
                },
                18: {
                    mejorar: 'Si sientes falta de apoyo social, es fundamental que busques construir o fortalecer tu red de apoyo. Participa en actividades sociales o grupos que te permitan conectar con personas que te apoyen.',
                    bueno: 'Mantén y nutre las relaciones que ya tienes, y sigue buscando formas de expandir tu red social para sentirte aún más apoyado.'
                },
                19: {
                    mejorar: 'Un mal equilibrio entre trabajo y vida puede llevar a agotamiento y estrés. Trabaja en establecer límites claros y en priorizar el autocuidado.',
                    bueno: 'Mejorar este equilibrio puede requerir ajustes en tu rutina diaria y una mayor atención a tus necesidades personales fuera del trabajo.'
                },
                20: {
                    mejorar: 'Si dudas de tu capacidad para mantener un bienestar emocional, es crucial que explores las barreras que te impiden lograrlo y consideres la terapia para desarrollar estrategias a largo plazo.',
                    bueno: 'Mantén el enfoque en tu bienestar emocional y sigue desarrollando hábitos saludables que te ayuden a mantenerlo en el tiempo.'
                }
            };

            return recommendations[questionNumber][category];
        }
    </script>
</body>
</html>
